diff -Naur openssl-1.0.2r/apps/progs.h openssl-1.0.2r/apps/progs.h
--- openssl-1.0.2r/apps/progs.h	2019-02-26 15:20:20.000000000 +0100
+++ openssl-1.0.2r/apps/progs.h	2019-04-03 22:56:14.061895095 +0200
@@ -45,7 +45,6 @@
 extern int engine_main(int argc, char *argv[]);
 extern int ocsp_main(int argc, char *argv[]);
 extern int prime_main(int argc, char *argv[]);
-extern int ts_main(int argc, char *argv[]);
 extern int srp_main(int argc, char *argv[]);
 
 #define FUNC_TYPE_GENERAL       1
@@ -138,7 +137,9 @@
     {FUNC_TYPE_GENERAL, "pkeyparam", pkeyparam_main},
     {FUNC_TYPE_GENERAL, "pkeyutl", pkeyutl_main},
     {FUNC_TYPE_GENERAL, "spkac", spkac_main},
+#ifndef OPENSSL_NO_SMIME
     {FUNC_TYPE_GENERAL, "smime", smime_main},
+#endif
     {FUNC_TYPE_GENERAL, "rand", rand_main},
 #ifndef OPENSSL_NO_ENGINE
     {FUNC_TYPE_GENERAL, "engine", engine_main},
@@ -147,7 +148,9 @@
     {FUNC_TYPE_GENERAL, "ocsp", ocsp_main},
 #endif
     {FUNC_TYPE_GENERAL, "prime", prime_main},
+#ifndef OPENSSL_NO_TS
     {FUNC_TYPE_GENERAL, "ts", ts_main},
+#endif
 #ifndef OPENSSL_NO_SRP
     {FUNC_TYPE_GENERAL, "srp", srp_main},
 #endif
diff -Naur openssl-1.0.2r/apps/progs.pl openssl-1.0.2r/apps/progs.pl
--- openssl-1.0.2r/apps/progs.pl	2019-02-26 15:20:20.000000000 +0100
+++ openssl-1.0.2r/apps/progs.pl	2019-04-03 23:01:56.227569529 +0200
@@ -37,6 +37,8 @@
 		{ print "#ifndef OPENSSL_NO_SPEED\n${str}#endif\n"; }
 	elsif ( ($_ =~ /^engine$/))
 		{ print "#ifndef OPENSSL_NO_ENGINE\n${str}#endif\n"; }
+	elsif ( ($_ =~ /^smime$/))
+		{ print "#ifndef OPENSSL_NO_SMIME\n${str}#endif\n"; }
 	elsif ( ($_ =~ /^rsa$/) || ($_ =~ /^genrsa$/) || ($_ =~ /^rsautl$/)) 
 		{ print "#ifndef OPENSSL_NO_RSA\n${str}#endif\n";  }
 	elsif ( ($_ =~ /^dsa$/) || ($_ =~ /^gendsa$/) || ($_ =~ /^dsaparam$/))
@@ -51,6 +53,8 @@
 		{ print "#ifndef OPENSSL_NO_CMS\n${str}#endif\n"; }
 	elsif ( ($_ =~ /^ocsp$/))
 		{ print "#ifndef OPENSSL_NO_OCSP\n${str}#endif\n"; }
+	elsif ( ($_ =~ /^ts$/))
+		{ print "#ifndef OPENSSL_NO_TS\n${str}#endif\n"; }
 	elsif ( ($_ =~ /^srp$/))
 		{ print "#ifndef OPENSSL_NO_SRP\n${str}#endif\n"; }
 	else
diff -Naur openssl-1.0.2r/apps/s_server.c openssl-1.0.2r/apps/s_server.c
--- openssl-1.0.2r/apps/s_server.c	2019-02-26 15:20:20.000000000 +0100
+++ openssl-1.0.2r/apps/s_server.c	2019-04-03 23:04:30.860272976 +0200
@@ -968,12 +968,14 @@
         if (!OCSP_REQUEST_add_ext(req, ext, -1))
             goto err;
     }
+#ifndef OPENSSL_NO_OCSP
     resp = process_responder(err, req, host, path, port, use_ssl, NULL,
                              srctx->timeout);
     if (!resp) {
         BIO_puts(err, "cert_status: error querying responder\n");
         goto done;
     }
+#endif
     rspderlen = i2d_OCSP_RESPONSE(resp, &rspder);
     if (rspderlen <= 0)
         goto err;
diff -Naur openssl-1.0.2r/apps/ts.c openssl-1.0.2r/apps/ts.c
--- openssl-1.0.2r/apps/ts.c	2019-02-26 15:20:20.000000000 +0100
+++ openssl-1.0.2r/apps/ts.c	2019-04-04 20:20:30.596547300 +0200
@@ -61,6 +61,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include "apps.h"
+
+#ifndef OPENSSL_NO_TS
+
 #include <openssl/bio.h>
 #include <openssl/err.h>
 #include <openssl/pem.h>
@@ -1117,3 +1120,5 @@
 
     return ok;
 }
+#endif
+
diff -Naur openssl-1.0.2r/crypto/err/err_all.c openssl-1.0.2r/crypto/err/err_all.c
--- openssl-1.0.2r/crypto/err/err_all.c	2019-02-26 15:20:20.000000000 +0100
+++ openssl-1.0.2r/crypto/err/err_all.c	2019-04-04 19:54:31.666677030 +0200
@@ -100,7 +100,9 @@
 #ifdef OPENSSL_FIPS
 # include <openssl/fips.h>
 #endif
+#ifndef OPENSSL_NO_TS
 #include <openssl/ts.h>
+#endif
 #ifndef OPENSSL_NO_CMS
 # include <openssl/cms.h>
 #endif
@@ -149,7 +151,9 @@
     ERR_load_PKCS12_strings();
     ERR_load_RAND_strings();
     ERR_load_DSO_strings();
+# ifndef OPENSSL_NO_TS
     ERR_load_TS_strings();
+# endif
 # ifndef OPENSSL_NO_ENGINE
     ERR_load_ENGINE_strings();
 # endif

